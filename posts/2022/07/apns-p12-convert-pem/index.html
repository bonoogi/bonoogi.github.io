<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때 | Hell yeah, World</title><meta name=keywords content="iOS,APNs,p12,pem,openssl,pkcs12,rc2-40-cbc,rc2-cbc"><meta name=description content="옛날 블로그 포스팅 보고 따라하다가 막힌 분들에게 바칩니다."><meta name=author content="구구리"><link rel=canonical href=https://bonoogi.github.io/posts/2022/07/apns-p12-convert-pem/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bonoogi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bonoogi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bonoogi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bonoogi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bonoogi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=naver-site-verification content="a7ed1273d644f391578cacca05f27cac326d7530"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1380985258636942" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DKVGJN68MW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DKVGJN68MW",{anonymize_ip:!1})}</script><meta property="og:title" content="APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때"><meta property="og:description" content="옛날 블로그 포스팅 보고 따라하다가 막힌 분들에게 바칩니다."><meta property="og:type" content="article"><meta property="og:url" content="https://bonoogi.github.io/posts/2022/07/apns-p12-convert-pem/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-17T17:16:39+09:00"><meta property="article:modified_time" content="2022-07-17T17:16:39+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때"><meta name=twitter:description content="옛날 블로그 포스팅 보고 따라하다가 막힌 분들에게 바칩니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"개발","item":"https://bonoogi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때","item":"https://bonoogi.github.io/posts/2022/07/apns-p12-convert-pem/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때","name":"APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때","description":"옛날 블로그 포스팅 보고 따라하다가 막힌 분들에게 바칩니다.","keywords":["iOS","APNs","p12","pem","openssl","pkcs12","rc2-40-cbc","rc2-cbc"],"articleBody":"APNs 서버에 통신하기 위해 인증하는 방법은 p8 인증서를 통한 토큰 인증 방식과 p12 인증서를 통한 인증서 인증 방식이 있다. p12 인증서 방식을 사용하면 1년에 한번씩 인증서를 새로 갱신해야 하기 때문에 여간 불편한게 아니기 때문에 아마 대부분은 p8 인증서를 통한 토큰 인증 방식을 사용하고 있을 것이다. 하지만 개발환경이라는게 이래저래 다양하고, 어떤 곳에서는 p12 인증서를 써야할 수 있다. 1년에 한번 하는게 그렇게 어려운 것도 아니고…\n하지만 1년에 한번이라는게 문제다. 1년만에 해보려니까 이래저래 헷갈릴 수가 있단 말이지. 다행히 애플측에서 인증서 발급과 관련해서 한국어 문서를 제공하고 있기 때문에(인증서 서명 요청 생성하기, TLS 인증서를 사용하여 APNs와 커뮤니케이션하기) 그렇게 어렵지는 않다. 다만 우리측 서버에 등록할 인증서와 키를 p12가 아닌 pem 파일로 변환해서 써야할 때가 있는데, 당연하게도 애플에서 딱히 이를 위한 방법을 알려주진 않는다. 그래서 열심히 검색을 해보면 아래와 같은 방법을 써보라고 나오는데…\n# 1. 인증서 파일 변환하기 # apns-cert.p12 파일을 apns-cert.pem으로 변환한다고 했을때 $ openssl pkcs12 \\ -clcerts \\ -nokeys \\ -out apns-cert.pem \\ -in apns-cert.key # 2. 키 파일 변환하기 # apns-key.p12 파일은 apns-key.pem으로 변환한다고 했을때 $ openssl pkcs12 \\ -nocerts \\ -out apns-key.pem \\ -in apns-key.p12 이걸 보고 그대로 따라하면 아마 높은 확률로 아래와 같은 오류 메시지를 마주하게 될 것이다.\n… :digital envelope routines:inner_evp_generic_fetch:unsupported:crypto/evp/evp_fetch.c:349:Global default library context, Algorithm (RC2-40-CBC : 0), Properties ()\n대충 읽어보면 unsupported, Algorithm, RC2-40-CBC와 같은 키워드가 눈에 보인다. 그러니까 정리하자면 RC2-40-CBC 알고리즘을 지원하지 않는다는 얘기인 것 같다. 아마도 애플에서 제공하는 p12 파일의 암호화에 RC2-40-CBC 알고리즘이 쓰이는 모양이다. 그렇다면 방법이 없을까? 그렇지 않다. openssl pkcs12 의 옵션을 차근차근 살펴보면 해당 알고리즘은 사용하도록 하는 옵션인 -legacy 가 있다. 해당 옵션에 대해서는 아래와 같이 설명하고 있다.\nIn the legacy mode, the default algorithm for certificate encryption is RC2_CBC or 3DES_CBC depending on whether the RC2 cipher is enabled in the build. The default algorithm for private key encryption is 3DES_CBC. If the legacy option is not specified, then the legacy provider is not loaded and the default encryption algorithm for both certificates and private keys is AES_256_CBC with PBKDF2 for key derivation.\n축약해서 말하자면 레거시 모드에서는 인증서 암호화를 위한 기본 알고리즘은 RC2_CBC나 3DES_CBC을 쓴단 말이다. 그러니 위의 명령어 입력에 적당히 -legacy 옵션을 껴넣어주면 문제없이 동작하는 것을 알 수 있다.\n","wordCount":"886","inLanguage":"en","datePublished":"2022-07-17T17:16:39+09:00","dateModified":"2022-07-17T17:16:39+09:00","author":{"@type":"Person","name":"구구리"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bonoogi.github.io/posts/2022/07/apns-p12-convert-pem/"},"publisher":{"@type":"Organization","name":"Hell yeah, World","logo":{"@type":"ImageObject","url":"https://bonoogi.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bonoogi.github.io/ accesskey=h title="Hell yeah, World (Alt + H)">Hell yeah, World</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bonoogi.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://bonoogi.github.io/search/ title=검색><span>검색</span></a></li><li><a href=https://bonoogi.github.io/posts/ title=개발><span>개발</span></a></li><li><a href=https://bonoogi.github.io/diary/ title=일기><span>일기</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>APNs 인증서(p12) 파일을 PEM 파일로 변경중에 오류가 발생했을 때</h1><div class=post-description>옛날 블로그 포스팅 보고 따라하다가 막힌 분들에게 바칩니다.</div><div class=post-meta><span title='2022-07-17 17:16:39 +0900 +0900'>July 17, 2022</span>&nbsp;·&nbsp;구구리</div></header><div class=post-content><p>APNs 서버에 통신하기 위해 인증하는 방법은 p8 인증서를 통한 토큰 인증 방식과 p12 인증서를 통한 인증서 인증 방식이 있다. p12 인증서 방식을 사용하면 1년에 한번씩 인증서를 새로 갱신해야 하기 때문에 여간 불편한게 아니기 때문에 아마 대부분은 p8 인증서를 통한 토큰 인증 방식을 사용하고 있을 것이다. 하지만 개발환경이라는게 이래저래 다양하고, 어떤 곳에서는 p12 인증서를 써야할 수 있다. 1년에 한번 하는게 그렇게 어려운 것도 아니고&mldr;</p><p>하지만 1년에 한번이라는게 문제다. 1년만에 해보려니까 이래저래 헷갈릴 수가 있단 말이지. 다행히 애플측에서 인증서 발급과 관련해서 한국어 문서를 제공하고 있기 때문에(인증서 서명 요청 생성하기, TLS 인증서를 사용하여 APNs와 커뮤니케이션하기) 그렇게 어렵지는 않다. 다만 우리측 서버에 등록할 인증서와 키를 p12가 아닌 pem 파일로 변환해서 써야할 때가 있는데, 당연하게도 애플에서 딱히 이를 위한 방법을 알려주진 않는다. 그래서 열심히 검색을 해보면 아래와 같은 방법을 써보라고 나오는데&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 1. 인증서 파일 변환하기</span>
</span></span><span style=display:flex><span><span style=color:#75715e># apns-cert.p12 파일을 apns-cert.pem으로 변환한다고 했을때</span>
</span></span><span style=display:flex><span>$ openssl pkcs12 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -clcerts <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -nokeys <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -out apns-cert.pem <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -in apns-cert.key
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 키 파일 변환하기</span>
</span></span><span style=display:flex><span><span style=color:#75715e># apns-key.p12 파일은 apns-key.pem으로 변환한다고 했을때</span>
</span></span><span style=display:flex><span>$ openssl pkcs12 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -nocerts <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -out apns-key.pem <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -in apns-key.p12
</span></span></code></pre></div><p>이걸 보고 그대로 따라하면 아마 높은 확률로 아래와 같은 오류 메시지를 마주하게 될 것이다.</p><blockquote><p>&mldr; :digital envelope routines:inner_evp_generic_fetch:unsupported:crypto/evp/evp_fetch.c:349:Global default library context, Algorithm (RC2-40-CBC : 0), Properties ()</p></blockquote><p>대충 읽어보면 unsupported, Algorithm, RC2-40-CBC와 같은 키워드가 눈에 보인다. 그러니까 정리하자면 RC2-40-CBC 알고리즘을 지원하지 않는다는 얘기인 것 같다. 아마도 애플에서 제공하는 p12 파일의 암호화에 RC2-40-CBC 알고리즘이 쓰이는 모양이다. 그렇다면 방법이 없을까? 그렇지 않다. openssl pkcs12 의 옵션을 차근차근 살펴보면 해당 알고리즘은 사용하도록 하는 옵션인 -legacy 가 있다. 해당 옵션에 대해서는 아래와 같이 설명하고 있다.</p><blockquote><p>In the legacy mode, the default algorithm for certificate encryption is RC2_CBC or 3DES_CBC depending on whether the RC2 cipher is enabled in the build. The default algorithm for private key encryption is 3DES_CBC. If the legacy option is not specified, then the legacy provider is not loaded and the default encryption algorithm for both certificates and private keys is AES_256_CBC with PBKDF2 for key derivation.</p></blockquote><p>축약해서 말하자면 레거시 모드에서는 인증서 암호화를 위한 기본 알고리즘은 RC2_CBC나 3DES_CBC을 쓴단 말이다. 그러니 위의 명령어 입력에 적당히 -legacy 옵션을 껴넣어주면 문제없이 동작하는 것을 알 수 있다.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bonoogi.github.io/tags/ios/>iOS</a></li><li><a href=https://bonoogi.github.io/tags/apns/>APNs</a></li><li><a href=https://bonoogi.github.io/tags/p12/>p12</a></li><li><a href=https://bonoogi.github.io/tags/pem/>pem</a></li><li><a href=https://bonoogi.github.io/tags/openssl/>openssl</a></li><li><a href=https://bonoogi.github.io/tags/pkcs12/>pkcs12</a></li><li><a href=https://bonoogi.github.io/tags/rc2-40-cbc/>rc2-40-cbc</a></li><li><a href=https://bonoogi.github.io/tags/rc2-cbc/>rc2-cbc</a></li></ul></footer><script src=https://utteranc.es/client.js repo=bonoogi/blog-comment issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://bonoogi.github.io/>Hell yeah, World</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>