<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기 | Hell yeah, World</title><meta name=keywords content="hugo,github,action,github-pages"><meta name=description content="근데 이제 휴고로 만든 깃헙 페이지를 곁들인"><meta name=author content="구구리"><link rel=canonical href=https://bonoogi.github.io/posts/2022/04/01-deploy-github-pages-from-other-repo/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bonoogi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bonoogi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bonoogi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bonoogi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bonoogi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=naver-site-verification content="a7ed1273d644f391578cacca05f27cac326d7530"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1380985258636942" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DKVGJN68MW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DKVGJN68MW",{anonymize_ip:!1})}</script><meta property="og:title" content="분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기"><meta property="og:description" content="근데 이제 휴고로 만든 깃헙 페이지를 곁들인"><meta property="og:type" content="article"><meta property="og:url" content="https://bonoogi.github.io/posts/2022/04/01-deploy-github-pages-from-other-repo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-17T11:55:28+09:00"><meta property="article:modified_time" content="2022-04-17T11:55:28+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기"><meta name=twitter:description content="근데 이제 휴고로 만든 깃헙 페이지를 곁들인"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"개발","item":"https://bonoogi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기","item":"https://bonoogi.github.io/posts/2022/04/01-deploy-github-pages-from-other-repo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기","name":"분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기","description":"근데 이제 휴고로 만든 깃헙 페이지를 곁들인","keywords":["hugo","github","action","github-pages"],"articleBody":"Intro 갑자기 직접 호스팅하는 블로그를 쓰고싶어져서 깃헙 페이지에 휴고로 만든 사이트를 올려놨다. 하는 김에 휴고 공식 문서를 참고해 깃헙 액션을 통한 자동 배포 설정도 추가하고. 근데 이 문서의 예제대로만 하면 깃헙 페이지 저장소에 단순히 프론트에 노출되는 파일 뿐 아니라 휴고 사이트 설정 파일이나 커스텀 레이아웃 파일 등도 포함되어야 한다. 물론 엄청나게 민감한 정보를 포함되지는 않지만 그래도 좀 찝찝하다. (완전히 동일한 비유는 아니지만) 저장소에 백/프론트가 함께 올라가있고, 거기에 누구나 접근할 수 있는 느낌이랄까?\n이렇게 다 들고 있을 필요가 있냐 이 말이지 기존 배포 코드 알아보기 name: GitHub Pages on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.91.2' # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == 'refs/heads/main' }} with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public 위 코드는 깃헙 액션 마켓플레이스에 있는 Hugo setup에 올라와있는 예시 코드이다. 이것들을 다 설명할 필요는 없고, 쭉쭉쭉쭉 내려와서 jobs \u003e deploy \u003e steps 아래 중에 Setup Hugo부터 보자.\nSetup Hugo - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.91.2' # extended: true 일단 얘는 peaceiris/actions-hugo@v2를 사용한다. 이거는 현재 액션을 수행하는 머신에 휴고 환경을 만들어주는 액션이다. 여기서는 보시다시피 사용할 휴고 버전을 명시할 수 있다. 본인이 원하는 대로 설정하자. 휴고 모듈을 캐싱한다던가, 저장소 내에 환경변수를 지정해 휴고 버전을 지정한다던가 하는 것은 굳이 여기서 얘기하지 않겠다. 위에서 링크를 걸어둔 Hugo setup 마켓플레이스 페이지로 가면 다 나와있다.\nBuild \u0026 Deploy - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == 'refs/heads/main' }} with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public 휴고 환경설정을 해줬으니 빌드는 간단하다. hugo --minify를 실행해준다. 이 명령어에 대한 설명은 Hugo CLI 문서의 ‘options’ 항목에서 찾을 수 있다. 간단하게\nminify any supported output format (HTML, XML etc.)\n라고 설명하고 있는데, 말 그대로 사이트 서빙을 위한 최소화된 파일을 생성해준다고 보면 된다.\n빌드를 했으니 배포해야겠지? 배포에는 peaceiris/actions-gh-pages를 사용한다. 깃헙 페이지를 위한 액션으로 이 역시 마켓플레이스에서 자세한 내용을 찾을 수 있다. 간단하게 설명하자면 publish_dir에서 지정한 디렉토리의 내용을 지정된 브랜치(기본값은 gh-pages)로 배포하는 것이다. 지금은 휴고 사이트 코드와 생성된 코드가 동일한 저장소에 존재하기 때문에 별도의 설정 없이 단순히 ${{ secrets.GITHUB_TOKEN }}으로 깃헙이 자동 생성해주는 토큰을 사용할 수 있다. 여기까지의 흐름은 다음과 같다(클릭하면 크게 볼 수 있다).\n하지만 우리의 목적은 이게 아니다. 깃헙 페이지 저장소가 아닌 별도의 저장소에 코드를 푸쉬하면 깃헙 액션 러너가 해당 코드를 기반으로 빌드하고 그 결과물만 깃헙 페이지 저장소에 배포해야 하는 것이다.\n사이트 코드 저장소의 깃헙 액션을 통해 페이지 저장소 코드에 배포하기 일단 우리가 원하는 모양새가 무엇인지 명확히 하기 위해 한번 더 도표를 그려보겠다(클릭하면 크게 볼 수 있다).\n차이가 느껴지는가? 별도로 소스 코드를 지니는 private 저장소를 마련해두고, 이 저장소에 코드가 푸쉬되면 액션을 수행하도록 하는 것이다.\nAction 수정 이때 전체적인 흐름은 위에서 보여준 yaml 파일과 비슷하지만, Deploy 부분이 약간 다르게 구성된다. 대충 이런 식이다.\n- name: Deploy uses: peaceiris/actions-gh-pages@v3 if: github.ref == 'refs/heads/main' with: deploy_key: ${{ secrets.GH_ACTION_DEPLOY_KEY }} external_repository: XXX/XXX.github.io publish_branch: main publish_dir: ./public 다른 부분은 다 같은데, 세 부분이 다르다. 바로 deploy_key, external_repository, publish_branch다. deploy_key에 대해서는 잠시 미뤄두고, 나머지 두 개를 먼저 살펴보자.\nexternal_repository는 말 그대로 외부 저장소를 말한다. 위의 도표를 보면 알다시피 Github Pages 저장소가 아닌 별도의 소스 코드 저장소에서 실행되는 액션이기 때문에 프론트 코드가 배포될 Github Pages 저장소를 따로 명시해야한다. 이 경우에는 사용자명이 XXX라 치고 값을 써두었다.\npublish_branch는 Github Pages의 프론트 코드가 main 브랜치로 배포되도록 지정한 것이다. peaceiris/actions-gh-pages 액션의 기본 설정은 사용자로 하여금 Github Pages 저장소의 main 브랜치가 아닌 별도의 브랜치(gh-pages)에 프론트 코드가 푸쉬되도록 한다. 그러면 이 별도의 브랜치에는 사이트 코드를 제외한 프론트 코드만 남아있어 하나의 저장소에서 두개의 코드를 들고 있는 것처럼 관리할 수 있다. 하지만 우리는 아예 저장소 자체를 분리해버렸기 때문에 브랜치로 소스를 분리할 필요가 없다. 그러니 그냥 main 브랜치로 배포하도록 지정하는 것이다.\ndeploy_key는 Github Pages 저장소에 생성된 코드를 배포하기 위한 배포키를 적는 곳이다. 그렇다면 왜 갑자기 배포키가 필요한 것일까? 이전 예시에서는 액션을 수행하는 저장소와 코드가 배포될 저장소가 동일한 저장소였기 때문에 자동으로 생성되는 토큰을 사용해도 문제가 없었다. 하지만 지금같은 경우에는 액션이 수행되는 저장소와 코드가 배포될 저장소가 다르기 때문에 자동으로 생성되는 토큰을 사용할 수 없다. 이와 같은 상황에 대비해 Github에서는 저장소별 Deploy Key를 지정하는 기능을 제공한다.\n생성된 코드를 배포하기 위한 Deploy Key 적용 Github Docs의 Generating a new SSH Key 문서를 참고해 배포를 위한 SSH 키쌍을 생성한다. 이 때 공개키와 비밀키가 한 쌍 생성되는데, 이걸 배포키로 등록하는 것이다.\nGithub Pages 저장소의 Settings 탭으로 이동하고 Deploy Key 메뉴로 들어간다. 그리고 오른쪽 위에 있는 ‘Add deploy key’를 눌러 진입한 페이지에서 필요한 내용을 붙여넣는다. 이후 ‘Allow write access’를 체크하고 ‘Add key’ 버튼을 클릭하면 배포 키가 등록된 것이다. 이때 ‘Allow write access’ 를 체크하지 않으면 배포키가 있어봤자 코드 푸쉬를 할 수 없으니 의미가 없다. 꼭 체크해주도록 하자.\n이걸로 Github Pages 저장소에 코드 배포를 할 수 있는 배포키의 공개키를 등록하는 작업을 완료했다. 이 공개키는 일종의 전용 출입문으로, 열쇠가 있다면 이 문을 통해 배포 작업을 수행할 수 있다. 그러면 이제는 액션을 수행하는 저장소에다가 출입문 열쇠를 알려줘야겠지? 별도로 마련한 깃헙 액션을 수행하는 휴고 사이트 코드 저장소의 Settings 탭으로 이동하고 Secrects 메뉴 아래 Actions 메뉴에 들어가 오른쪽 위의 ‘New repository secret’ 버튼을 눌러 비밀키 입력 화면을 들어간다. 해당 화면에서 Name에는 Github Actions의 선언파일에서 호출할 Secret의 변수명을 지정한다. 아까 위에서 deploy_key: ${{ secrets.GH_ACTION_DEPLOY_KEY }} 라는 부분이 있었을텐데, 이 GH_ACTION_DEPLOY_KEY가 이에 해당한다. Value에는 비밀키 내용을 빠짐없이 붙여넣는다(Begin 어쩌구 End 어떠구 하는 부분 포함).\n이제 액션을 수행할 저장소에게 적절한 열쇠를 쥐여주고, 배포 동작을 할때 어떤 열쇠를 들고가야할지 알려주었으니 뭔가 변경사항을 만든 다음에 코드를 푸쉬해보자. 알아서 배포가 착착 진행되는 것을 확인할 수 있다.\n","wordCount":"2560","inLanguage":"en","datePublished":"2022-04-17T11:55:28+09:00","dateModified":"2022-04-17T11:55:28+09:00","author":{"@type":"Person","name":"구구리"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bonoogi.github.io/posts/2022/04/01-deploy-github-pages-from-other-repo/"},"publisher":{"@type":"Organization","name":"Hell yeah, World","logo":{"@type":"ImageObject","url":"https://bonoogi.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bonoogi.github.io/ accesskey=h title="Hell yeah, World (Alt + H)">Hell yeah, World</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bonoogi.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://bonoogi.github.io/search/ title=검색><span>검색</span></a></li><li><a href=https://bonoogi.github.io/posts/ title=개발><span>개발</span></a></li><li><a href=https://bonoogi.github.io/diary/ title=일기><span>일기</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>분리된 코드 저장소에서 깃헙 액션을 통해 깃헙 페이지 배포하기</h1><div class=post-description>근데 이제 휴고로 만든 깃헙 페이지를 곁들인</div><div class=post-meta><span title='2022-04-17 11:55:28 +0900 +0900'>April 17, 2022</span>&nbsp;·&nbsp;구구리</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#intro aria-label=Intro>Intro</a></li><li><a href=#%ea%b8%b0%ec%a1%b4-%eb%b0%b0%ed%8f%ac-%ec%bd%94%eb%93%9c-%ec%95%8c%ec%95%84%eb%b3%b4%ea%b8%b0 aria-label="기존 배포 코드 알아보기">기존 배포 코드 알아보기</a><ul><li><a href=#setup-hugo aria-label="Setup Hugo">Setup Hugo</a></li><li><a href=#build--deploy aria-label="Build &amp;amp; Deploy">Build & Deploy</a></li></ul></li><li><a href=#%ec%82%ac%ec%9d%b4%ed%8a%b8-%ec%bd%94%eb%93%9c-%ec%a0%80%ec%9e%a5%ec%86%8c%ec%9d%98-%ea%b9%83%ed%97%99-%ec%95%a1%ec%85%98%ec%9d%84-%ed%86%b5%ed%95%b4-%ed%8e%98%ec%9d%b4%ec%a7%80-%ec%a0%80%ec%9e%a5%ec%86%8c-%ec%bd%94%eb%93%9c%ec%97%90-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="사이트 코드 저장소의 깃헙 액션을 통해 페이지 저장소 코드에 배포하기">사이트 코드 저장소의 깃헙 액션을 통해 페이지 저장소 코드에 배포하기</a><ul><li><a href=#action-%ec%88%98%ec%a0%95 aria-label="Action 수정">Action 수정</a></li><li><a href=#%ec%83%9d%ec%84%b1%eb%90%9c-%ec%bd%94%eb%93%9c%eb%a5%bc-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0-%ec%9c%84%ed%95%9c-deploy-key-%ec%a0%81%ec%9a%a9 aria-label="생성된 코드를 배포하기 위한 Deploy Key 적용">생성된 코드를 배포하기 위한 Deploy Key 적용</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h2><p>갑자기 직접 호스팅하는 블로그를 쓰고싶어져서 깃헙 페이지에 휴고로 만든 사이트를 올려놨다. 하는 김에 <a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/>휴고 공식 문서</a>를 참고해 깃헙 액션을 통한 자동 배포 설정도 추가하고. 근데 이 문서의 예제대로만 하면 깃헙 페이지 저장소에 단순히 프론트에 노출되는 파일 뿐 아니라 휴고 사이트 설정 파일이나 커스텀 레이아웃 파일 등도 포함되어야 한다. 물론 엄청나게 민감한 정보를 포함되지는 않지만 그래도 좀 찝찝하다. (완전히 동일한 비유는 아니지만) 저장소에 백/프론트가 함께 올라가있고, 거기에 누구나 접근할 수 있는 느낌이랄까?</p><p><figure><img src=/images/2022/04/deploy-github-pages-from-other-repo/00.jpg alt="Github Pages Repository 라고 쓰여있는 모서리가 둥근 사각형 안에 각각 Site Code라고 써있는 원과 Generated Code라고 써있는 원이 들어있는 모양"><figcaption>이렇게 다 들고 있을 필요가 있냐 이 말이지</figcaption></figure></p><h2 id=기존-배포-코드-알아보기>기존 배포 코드 알아보기<a hidden class=anchor aria-hidden=true href=#기존-배포-코드-알아보기>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>GitHub Pages</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main </span> <span style=color:#75715e># Set a branch to deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pull_request</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-20.04</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>concurrency</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>group</span>: <span style=color:#ae81ff>${{ github.workflow }}-${{ github.ref }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>  <span style=color:#75715e># Fetch Hugo themes (true OR recursive)</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>0</span>    <span style=color:#75715e># Fetch all history for .GitInfo and .Lastmod</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;0.91.2&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># extended: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.ref == &#39;refs/heads/main&#39; }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>github_token</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
</span></span></code></pre></div><p>위 코드는 깃헙 액션 마켓플레이스에 있는 <a href=https://github.com/marketplace/actions/hugo-setup>Hugo setup</a>에 올라와있는 예시 코드이다. 이것들을 다 설명할 필요는 없고, 쭉쭉쭉쭉 내려와서 <code>jobs</code> > <code>deploy</code> > <code>steps</code> 아래 중에 <code>Setup Hugo</code>부터 보자.</p><h3 id=setup-hugo>Setup Hugo<a hidden class=anchor aria-hidden=true href=#setup-hugo>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;0.91.2&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># extended: true</span>
</span></span></code></pre></div><p>일단 얘는 <code>peaceiris/actions-hugo@v2</code>를 사용한다. 이거는 현재 액션을 수행하는 머신에 휴고 환경을 만들어주는 액션이다. 여기서는 보시다시피 사용할 휴고 버전을 명시할 수 있다. 본인이 원하는 대로 설정하자. 휴고 모듈을 캐싱한다던가, 저장소 내에 환경변수를 지정해 휴고 버전을 지정한다던가 하는 것은 굳이 여기서 얘기하지 않겠다. 위에서 링크를 걸어둔 Hugo setup 마켓플레이스 페이지로 가면 다 나와있다.</p><h3 id=build--deploy>Build & Deploy<a hidden class=anchor aria-hidden=true href=#build--deploy>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.ref == &#39;refs/heads/main&#39; }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>github_token</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
</span></span></code></pre></div><p>휴고 환경설정을 해줬으니 빌드는 간단하다. <code>hugo --minify</code>를 실행해준다. 이 명령어에 대한 설명은 <a href=https://gohugo.io/commands/hugo/#options>Hugo CLI 문서의 &lsquo;options&rsquo;</a> 항목에서 찾을 수 있다. 간단하게</p><blockquote><p>minify any supported output format (HTML, XML etc.)</p></blockquote><p>라고 설명하고 있는데, 말 그대로 사이트 서빙을 위한 최소화된 파일을 생성해준다고 보면 된다.</p><p>빌드를 했으니 배포해야겠지? 배포에는 <code>peaceiris/actions-gh-pages</code>를 사용한다. 깃헙 페이지를 위한 액션으로 이 역시 <a href=https://github.com/marketplace/actions/github-pages-action>마켓플레이스에서 자세한 내용</a>을 찾을 수 있다. 간단하게 설명하자면 <code>publish_dir</code>에서 지정한 디렉토리의 내용을 지정된 브랜치(기본값은 <code>gh-pages</code>)로 배포하는 것이다. 지금은 휴고 사이트 코드와 생성된 코드가 동일한 저장소에 존재하기 때문에 별도의 설정 없이 단순히 <code>${{ secrets.GITHUB_TOKEN }}</code>으로 깃헙이 자동 생성해주는 토큰을 사용할 수 있다. 여기까지의 흐름은 다음과 같다(클릭하면 크게 볼 수 있다).</p><p><a href=/images/2022/04/deploy-github-pages-from-other-repo/01.png><img src=/images/2022/04/deploy-github-pages-from-other-repo/01.png alt="Github Pages 저장소에 코드 변경사항이 생겼을때 Github Actions를 통해 사이트를 생성하고 스스로 배포하는 흐름을 묘사한 그림"></a></p><p>하지만 우리의 목적은 이게 아니다. 깃헙 페이지 저장소가 아닌 별도의 저장소에 코드를 푸쉬하면 깃헙 액션 러너가 해당 코드를 기반으로 빌드하고 그 결과물만 깃헙 페이지 저장소에 배포해야 하는 것이다.</p><h2 id=사이트-코드-저장소의-깃헙-액션을-통해-페이지-저장소-코드에-배포하기>사이트 코드 저장소의 깃헙 액션을 통해 페이지 저장소 코드에 배포하기<a hidden class=anchor aria-hidden=true href=#사이트-코드-저장소의-깃헙-액션을-통해-페이지-저장소-코드에-배포하기>#</a></h2><p>일단 우리가 원하는 모양새가 무엇인지 명확히 하기 위해 한번 더 도표를 그려보겠다(클릭하면 크게 볼 수 있다).</p><p><a href=/images/2022/04/deploy-github-pages-from-other-repo/02.png><img src=/images/2022/04/deploy-github-pages-from-other-repo/02.png alt="별도의 블로그 소스 코드 변경사항이 생기면 Github Actions를 통해 사이트를 생성하고 Github Pages 저장소로 배포하는 흐름을 묘사한 그림"></a></p><p>차이가 느껴지는가? 별도로 소스 코드를 지니는 private 저장소를 마련해두고, 이 저장소에 코드가 푸쉬되면 액션을 수행하도록 하는 것이다.</p><h3 id=action-수정>Action 수정<a hidden class=anchor aria-hidden=true href=#action-수정>#</a></h3><p>이때 전체적인 흐름은 위에서 보여준 yaml 파일과 비슷하지만, Deploy 부분이 약간 다르게 구성된다. 대충 이런 식이다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>if</span>: <span style=color:#ae81ff>github.ref == &#39;refs/heads/main&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy_key</span>: <span style=color:#ae81ff>${{ secrets.GH_ACTION_DEPLOY_KEY }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>external_repository</span>: <span style=color:#ae81ff>XXX/XXX.github.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish_branch</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
</span></span></code></pre></div><p>다른 부분은 다 같은데, 세 부분이 다르다. 바로 <code>deploy_key</code>, <code>external_repository</code>, <code>publish_branch</code>다. <code>deploy_key</code>에 대해서는 잠시 미뤄두고, 나머지 두 개를 먼저 살펴보자.</p><p><code>external_repository</code>는 말 그대로 외부 저장소를 말한다. 위의 도표를 보면 알다시피 Github Pages 저장소가 아닌 별도의 소스 코드 저장소에서 실행되는 액션이기 때문에 프론트 코드가 배포될 Github Pages 저장소를 따로 명시해야한다. 이 경우에는 사용자명이 <code>XXX</code>라 치고 값을 써두었다.</p><p><code>publish_branch</code>는 Github Pages의 프론트 코드가 <code>main</code> 브랜치로 배포되도록 지정한 것이다. <code>peaceiris/actions-gh-pages</code> 액션의 기본 설정은 사용자로 하여금 Github Pages 저장소의 <code>main</code> 브랜치가 아닌 별도의 브랜치(<code>gh-pages</code>)에 프론트 코드가 푸쉬되도록 한다. 그러면 이 별도의 브랜치에는 사이트 코드를 제외한 프론트 코드만 남아있어 하나의 저장소에서 두개의 코드를 들고 있는 것처럼 관리할 수 있다. 하지만 우리는 아예 저장소 자체를 분리해버렸기 때문에 브랜치로 소스를 분리할 필요가 없다. 그러니 그냥 <code>main</code> 브랜치로 배포하도록 지정하는 것이다.</p><p><code>deploy_key</code>는 Github Pages 저장소에 생성된 코드를 배포하기 위한 배포키를 적는 곳이다. 그렇다면 왜 갑자기 배포키가 필요한 것일까? 이전 예시에서는 액션을 수행하는 저장소와 코드가 배포될 저장소가 동일한 저장소였기 때문에 자동으로 생성되는 토큰을 사용해도 문제가 없었다. 하지만 지금같은 경우에는 액션이 수행되는 저장소와 코드가 배포될 저장소가 다르기 때문에 자동으로 생성되는 토큰을 사용할 수 없다. 이와 같은 상황에 대비해 Github에서는 저장소별 <a href=https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys>Deploy Key</a>를 지정하는 기능을 제공한다.</p><h3 id=생성된-코드를-배포하기-위한-deploy-key-적용>생성된 코드를 배포하기 위한 Deploy Key 적용<a hidden class=anchor aria-hidden=true href=#생성된-코드를-배포하기-위한-deploy-key-적용>#</a></h3><p><a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key>Github Docs의 Generating a new SSH Key 문서</a>를 참고해 배포를 위한 SSH 키쌍을 생성한다. 이 때 공개키와 비밀키가 한 쌍 생성되는데, 이걸 배포키로 등록하는 것이다.</p><hr><p><a href=/images/2022/04/deploy-github-pages-from-other-repo/03.png><img src=/images/2022/04/deploy-github-pages-from-other-repo/03.png alt="Github Pages 저장소의 Deploy Keys 메뉴에서 새 키를 설정하는 화면"></a></p><p><strong>Github Pages 저장소</strong>의 Settings 탭으로 이동하고 Deploy Key 메뉴로 들어간다. 그리고 오른쪽 위에 있는 &lsquo;Add deploy key&rsquo;를 눌러 진입한 페이지에서 필요한 내용을 붙여넣는다. 이후 &lsquo;Allow write access&rsquo;를 체크하고 &lsquo;Add key&rsquo; 버튼을 클릭하면 배포 키가 등록된 것이다. 이때 &lsquo;Allow write access&rsquo; 를 체크하지 않으면 배포키가 있어봤자 코드 푸쉬를 할 수 없으니 의미가 없다. 꼭 체크해주도록 하자.</p><hr><p><a href=/images/2022/04/deploy-github-pages-from-other-repo/04.png><img src=/images/2022/04/deploy-github-pages-from-other-repo/04.png alt="Hugo 사이트 코드 저장소의 Secrets 메뉴 아래 Actions 메뉴에서 새 키를 설정하는 화면"></a></p><p>이걸로 Github Pages 저장소에 코드 배포를 할 수 있는 배포키의 공개키를 등록하는 작업을 완료했다. 이 공개키는 일종의 전용 출입문으로, 열쇠가 있다면 이 문을 통해 배포 작업을 수행할 수 있다. 그러면 이제는 액션을 수행하는 저장소에다가 출입문 열쇠를 알려줘야겠지? 별도로 마련한 깃헙 액션을 수행하는 휴고 사이트 코드 저장소의 Settings 탭으로 이동하고 Secrects 메뉴 아래 Actions 메뉴에 들어가 오른쪽 위의 &lsquo;New repository secret&rsquo; 버튼을 눌러 비밀키 입력 화면을 들어간다. 해당 화면에서 Name에는 Github Actions의 선언파일에서 호출할 Secret의 변수명을 지정한다. 아까 위에서 <code>deploy_key: ${{ secrets.GH_ACTION_DEPLOY_KEY }}</code> 라는 부분이 있었을텐데, 이 <code>GH_ACTION_DEPLOY_KEY</code>가 이에 해당한다. Value에는 비밀키 내용을 빠짐없이 붙여넣는다(Begin 어쩌구 End 어떠구 하는 부분 포함).</p><p>이제 액션을 수행할 저장소에게 적절한 열쇠를 쥐여주고, 배포 동작을 할때 어떤 열쇠를 들고가야할지 알려주었으니 뭔가 변경사항을 만든 다음에 코드를 푸쉬해보자. 알아서 배포가 착착 진행되는 것을 확인할 수 있다.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bonoogi.github.io/tags/hugo/>hugo</a></li><li><a href=https://bonoogi.github.io/tags/github/>github</a></li><li><a href=https://bonoogi.github.io/tags/action/>action</a></li><li><a href=https://bonoogi.github.io/tags/github-pages/>github-pages</a></li></ul></footer><script src=https://utteranc.es/client.js repo=bonoogi/blog-comment issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://bonoogi.github.io/>Hell yeah, World</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>