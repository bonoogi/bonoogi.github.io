<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸° | Hell yeah, World</title><meta name=keywords content="iOS,Swift,UIKit,Combine,Delegate,RxSwift,RxCocoa"><meta name=description content="ê·¼ë° ì†”ì§íˆ í´ë˜ìŠ¤ ë‚´ì—ì„œ ê± Delegate êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œ?"><meta name=author content="êµ¬êµ¬ë¦¬"><link rel=canonical href=https://bonoogi.github.io/posts/2022/11/delegate-publisher/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bonoogi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bonoogi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bonoogi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bonoogi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bonoogi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=naver-site-verification content="a7ed1273d644f391578cacca05f27cac326d7530"><script async src="https://www.googletagmanager.com/gtag/js?id=G-DKVGJN68MW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DKVGJN68MW",{anonymize_ip:!1})}</script><meta property="og:title" content="UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°"><meta property="og:description" content="ê·¼ë° ì†”ì§íˆ í´ë˜ìŠ¤ ë‚´ì—ì„œ ê± Delegate êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œ?"><meta property="og:type" content="article"><meta property="og:url" content="https://bonoogi.github.io/posts/2022/11/delegate-publisher/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-20T16:48:29+09:00"><meta property="article:modified_time" content="2022-11-20T16:48:29+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°"><meta name=twitter:description content="ê·¼ë° ì†”ì§íˆ í´ë˜ìŠ¤ ë‚´ì—ì„œ ê± Delegate êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bonoogi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°","item":"https://bonoogi.github.io/posts/2022/11/delegate-publisher/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°","name":"UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°","description":"ê·¼ë° ì†”ì§íˆ í´ë˜ìŠ¤ ë‚´ì—ì„œ ê± Delegate êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œ?","keywords":["iOS","Swift","UIKit","Combine","Delegate","RxSwift","RxCocoa"],"articleBody":"Reactive Programmingì˜ ëŒ€ëª…ì‚¬ ê·¸ ìì²´ì¸ Reactive Extension(ì´í•˜ Rx), ê·¸ë¦¬ê³  ê·¸ ì¤‘ì—ì„œë„ Apple ìƒíƒœê³„ ê°œë°œìë¥¼ ìœ„í•œ Rx êµ¬í˜„ì¸ RxSwift, ê·¸ ì¤‘ì—ì„œë„ UIKitì„ ìœ„í•œ êµ¬í˜„ì¸ RxCocoaë¥¼ ë³´ë©´ ê°ì¢… UIKitì˜ Delegate íŒ¨í„´ì— ëŒ€ì‘í•˜ëŠ” Observableì„ ì œê³µí•˜ê³  ìˆë‹¤. Rxë¥¼ ì²˜ìŒ ì ‘í•œ ê·¸ ë‹¹ì‹œì—ëŠ” â€˜ì™€ ì”» ì™„ì „ ì‹ ì„¸ê³„ë‹¤!â€™ ì‹¶ì–´ ê±°ì˜ ëª¨ë“  ì½”ë“œë¥¼ Rx ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í–ˆì—ˆëŠ”ë°, ê·¸ë˜ì„œ Delegate íŒ¨í„´ì— ëŒ€í•œ êµ¬í˜„ë„ Rxë¥¼ ë§ì´ ì¼ë˜ ê¸°ì–µì´ ë‚œë‹¤. ì§€ê¸ˆì€ ê± Delegateë¥¼ ì§ì ‘ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ì¢€ ë” ì„ í˜¸í•˜ëŠ” í¸ì´ì§€ë§Œâ€¦\nì–´ì¨Œë“ , ìµœê·¼ì— ì§„í–‰í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ RxSwift ì˜ì¡´ì„±ì„ Combineìœ¼ë¡œ ì´ì „í•˜ëŠ” ì‘ì—…ì„ í–ˆë‹¤. ì´ ë•Œ UIScrollViewDelegateì˜ scrollViewDidScroll(_ scrollView: UIScrollView) ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œì˜ ë™ì‘ì„ Combineìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì‘ì—…ë„ ê°™ì´ ì§„í–‰í–ˆëŠ”ë°, ì´ ì²˜ë¦¬ì— ëŒ€í•´ì„œ ì¢€ ì•Œì•„ë³´ë„ë¡ í•˜ì.\nì¼ë‹¨ ì„¸ ê°€ì§€ì˜ íƒ€ì…ì´ í•„ìš”í•˜ë‹¤. Publisher í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ëŠ” íƒ€ì…ê³¼ Subscription í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ëŠ” íƒ€ì…(ê° í”„ë¡œí† ì½œì´ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ëŠ” ë¬¸ì„œë¥¼ í†µí•´ ì•Œì•„ë³´ë„ë¡ í•˜ì). ê·¸ë¦¬ê³  UIScrollViewDelegateì˜ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œê°€ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ê¸° ìœ„í•œ ì—´ê±°í˜• íƒ€ì….\nê·¸ë¦¬ê³  UIScrollViewDelegateì— ëŒ€í•œ êµ¬í˜„ì´ê¸° ë•Œë¬¸ì— UIScrollViewì— ëŒ€í•œ í™•ì¥ìœ¼ë¡œ ì„ ì–¸í•˜ëŠ”ê²Œ ì¨ë¨¹ê¸° í¸í• ê±°ë¼ ìƒê°í–ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ê²°êµ­ ë‹¤ìŒì˜ ì„¸ íƒ€ì…ì„ ë§Œë“¤ê²Œ ë  ê²ƒì´ë‹¤.\nUIScrollView.DelegateEvent(ì´í•˜ DelegateEvent): UIScrollViewDelegateì˜ ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ í˜¸ì¶œë  ë©”ì„œë“œì™€ ì¸ìë¥¼ ì „ë‹¬í•´ì¤„ íƒ€ì…. ê°„ë‹¨í•˜ê²Œ enumìœ¼ë¡œ êµ¬í˜„í•  ì˜ˆì •ì´ë‹¤. UIScrollView.DelegateSubscription(ì´í•˜ DelegateSubscription): êµ¬ë…ì‹œ êµ¬ë…ìì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ì¤„ íƒ€ì…ìœ¼ë¡œ(ìì„¸í•œ ê²ƒì„ ì• í”Œì˜ Combine.Subscription ë¬¸ì„œë¥¼ í™•ì¸), ì‹¤ì œë¡œ UIScrollViewDelegateë¥¼ êµ¬í˜„í•˜ëŠ” íƒ€ì…ì´ ë ê²ƒì´ë‹¤. UIScrollView.DelegatePublisher(ì´í•˜ DelegatePublisher): ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ì¤„ ê²Œì‹œì íƒ€ì…. ì´ ì—­ì‹œ ì• í”Œì˜ Combine.Publisher ë¬¸ì„œë¥¼ í™•ì¸í•˜ì. ìœ„ ì„¸ê°€ì§€ íƒ€ì…ì„ ê¸°ëŠ¥ë§Œ í•˜ë„ë¡ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì´ë‹¤. ê¸°ë³¸ êµ¬í˜„ ìì²´ì— ëŒ€í•´ì„œëŠ” ë”°ë¡œ ì„¤ëª…í•˜ì§„ ì•Šê² ë‹¤. Subscriptionê³¼ Publisher êµ¬í˜„ì˜ ê²½ìš° SwiftBySundellì˜ Building custom Combine publishers in Swiftì„ ì°¸ê³ í•˜ì˜€ìœ¼ë‹ˆ í•´ë‹¹ ì•„í‹°í´ì„ ì²´í¬í•˜ê¸¸ ë°”ë€ë‹¤.\nenum DelegateEvent { /// `scrollViewDidScroll(_ scrollView: UIScrollView)` ì— ëŒ€ì‘í•˜ëŠ” ì¼€ì´ìŠ¤ case didScroll(UIScrollView) } class DelegateSubscription: NSObject, UIScrollViewDelegate, Subscription where S.Input == DelegateEvent, S.Failure == Never { private var subscriber: S? init(subscriber: S) { self.subscriber = subscriber } func request(_ demand: Subscribers.Demand) { /* Do Nothing */ } func cancel() { subscriber = nil } // UIScrollViewDelegate êµ¬í˜„ func scrollViewDidScroll(_ scrollView: UIScrollView) { _ = subscriber?.receive(.didScroll(scrollView)) } } struct DelegatePublisher: Publisher { typealias Output = DelegateEvent typealias Failure = Never private let scrollView: UIScrollView init(scrollView: UIScrollView) { self.scrollView = scrollView } func receive(subscriber: S) where S: Subscriber, Never == S.Failure, DelegateEvent == S.Input { let subscription = DelegateSubscription(subscriber: subscriber) subscriber.receive(subscription: subscription) scrollView.delegate = subscription } } ìœ„ì™€ ê°™ì´ êµ¬í˜„í•˜ê³  UIScrollViewì˜ í™•ì¥ì— ê³„ì‚° í”„ë¡œí¼í‹°ë¡œ delegatePublisherë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\nextension UIScrollView { var delegatePublisher: DelegatePublisher { return DelegatePublisher(scrollView: self) } } let scrollView = UIScrollView() let cancellable = scrollView .delegatePublisher .sink { event in switch event { case .didScroll(let scrollView): // Do Something With `scrollView` } } ì œë²• ê°„ë‹¨í•˜ë‹¤. í•˜ì§€ë§Œ ì´ ë•Œ ë¬¸ì œê°€ í•˜ë‚˜ ìˆë‹¤. UIScrollView.delegateëŠ” UIViewì— UIGestureRecognizerë¥¼ ë“±ë¡í•˜ë“¯ì´ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ”ê²Œ ì•„ë‹ˆê³ , í•œ ë²ˆì— í•˜ë‚˜ì˜ delegateë§Œ í• ë‹¹í•  ìˆ˜ ìˆê¸° ë•Œë¬¸. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ ì½”ë“œì—ì„œëŠ” ë‘ ë²ˆì§¸ delegatePublsherë¥¼ í˜¸ì¶œí•  ë•Œ ì²«ë²ˆì§¸ë¡œ í˜¸ì¶œí•œ delegatePublisherëŠ” scrollViewì˜ delegateê°€ ì•„ë‹ˆê²Œ ëœë‹¤.\nvar first = scrollView.delegatePublisher.sink { _ in print(\"Useless!\") } var second = scrollView.delegatePublisher.sink { _ in print(\"Only Works!\") } // ì•„ë˜ì™€ ê°™ì´ í•´ê²°í•  ìˆ˜ëŠ” ìˆì§€ë§Œ ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ `share()`ë¡œ // ë³„ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹¤ìˆ˜í•˜ê¸°ì— ë„ˆë¬´ ì¢‹ì€ ì½”ë“œì´ë‹¤. let sharedDelegatePublisher = scrollView.delegatePublisher.share() first = sharedDelegatePublisher.sink { _ in print(\"It Works!\") } second = sharedDelegatePublisher.sink { _ in print(\"It Works, Too!\") } ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ delegatePublisherë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•´ë„ ê³„ì† ì¨ë¨¹ì„ ìˆ˜ ìˆì„ê¹Œ? ì´ë¥¼ ìœ„í•´ì„œëŠ” ë‘ ê°€ì§€ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤.\nUIScrollView.delegatePublisherê°€ UIScrollView ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ë‹¹ í•˜ë‚˜ë§Œ ìƒì„±ë˜ì–´ì•¼ í•œë‹¤. ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±í•˜ë©´ ì´ì „ì— ìƒì„±í•œ Publisherì— ëŒ€í•œ Subscriptionì€ ì˜ë¯¸ê°€ ì—†ì–´ì§€ë‹ˆê¹Œ. ìœ„ì—ì„œ ìƒê¸´ í•˜ë‚˜ì˜ DelegatePublisherë¥¼ ì—¬ëŸ¬ Subscriberê°€ ê³µìœ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. Subscriberê°€ ìƒê¸¸ë•Œë§ˆë‹¤ delegateë¥¼ í• ë‹¹í•˜ë©´ ê²°êµ­ ì—¬ì „íˆ ìµœí›„ì˜ Subscriberë§Œ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ. ì²«ë²ˆì§¸ ì¡°ê±´ì€ ë°”ê¿” ë§í•˜ìë©´ UIScrollView ì¸ìŠ¤í„´ìŠ¤ê°€ íŠ¹ì •ë˜ë©´ ê±°ê¸°ì— ì—°ê²°ëœ DelegatePublisherë„ íŠ¹ì •í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ëŠ” ì–˜ê¸°ë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” RxSwiftê°€ í•´ê²°í•œ ë°©ë²•ì„ ì°¸ê³ í–ˆë‹¤. ì´ ì¹œêµ¬ë“¤ì€ RxCocoa ë‚´ì— DelegateProxyTypeì´ë¼ëŠ” íƒ€ì…ì„ ë§Œë“¤ì–´ì„œ ë³„ë„ì˜ ëŒ€ë¦¬ìë¥¼ ë§Œë“¤ì—ˆê³ , ì´ ì¹œêµ¬ë¥¼ UIScrollView ì¸ìŠ¤í„´ìŠ¤ì—ë‹¤ê°€ Associated Objectë¡œ í• ë‹¹ì„ í•˜ëŠ” ì‹ìœ¼ë¡œ í•´ê²°í•˜ì˜€ë‹¤. ë¬¼ë¡  DelegateProxyTypeì´ Delegate ì—­í• ì„ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê³ , ì¼ì¢…ì˜ ì—°ê²°ì ì´ë¼ê³  ë³´ëŠ”ê²Œ ë‚«ê² ì§€ë§Œâ€¦(proxyë¼ëŠ” ë§ì„ ê´œíˆ ì“´ê²Œ ì•„ë‹˜)\në‘ë²ˆì§¸ ì¡°ê±´ì€ ì˜ ìƒê°í•´ë³´ë©´ ì–´ë””ì„œ ë³¸ ë§ì´ë‹¤. ë°”ë¡œ Publishers.Shareë‹¤. ì• í”Œ ë¬¸ì„œìƒì—ì„œ ì´ ì¹œêµ¬ì˜ ì •ì˜ë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì™€ìˆë‹¤.\nA publisher that shares the output of an upstream publisher with multiple subscribers.\nUpstream Publisherì˜ ë°°ì¶œì„ ì—¬ëŸ¬ Subscriberì™€ ê³µìœ í•˜ëŠ” Publisher. ê²°êµ­ ë‘ë²ˆì§¸ ì¡°ê±´ì€ Shareë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°ëœë‹¤. ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë§Œë“¤ì–´ì§„ë‹¤.\nextension UIScrollView { var delegatePublisher: AnyPublisher { /** `ObjectIdentifier`ëŠ” `AnyObject` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°›ê±°ë‚˜ `Any.Type` í˜•íƒœì˜ ë©”íƒ€íƒ€ì…ì„ ë°›ì•„ì„œ IDë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš°ì—ëŠ” `UIScrollView` ì¸ìŠ¤í„´ìŠ¤ì— ìœ ì¼í•œ `DelegatePublisher`ë¥¼ í• ë‹¹í•˜ëŠ”ê²Œ ëª©í‘œì´ë‹ˆ ë©”íƒ€íƒ€ì…ì„ í†µí•´ IDë¥¼ ìƒì„±í•œë‹¤. ì‚¬ì‹¤ ì´ë ‡ê²Œ ì•ˆí•˜ê³  ì•„ë˜ì²˜ëŸ¼ íŠ¹ì • ë¬¸ìì—´ì„ ë§Œë“¤ì–´ì„œ ê·¸ì— ëŒ€í•œ UnsafeRawPointerë¥¼ ë§Œë“¤ì–´ë„ ë¬´ë°©í•  ê²ƒ ê°™ë‹¤. let someStr = \"SomeStr\" let rawPointer = \u0026someStr */ let objectIdentifier = ObjectIdentifier(DelegatePublisher.self) let integerIdentifier = Int(bitPattern: objectIdentifier) let rawPointer = UnsafeRawPointer(bitPatter: integerIdentifier)! if let existingPublisher = objc_getAssociatedObject(self, rawPointer) as? AnyPublisher { return existingPublisher } else { let newPublisher = DelegatePublisher(scrollView: self) // ì—¬ëŸ¬ Subscriberê°€ í•˜ë‚˜ì˜ Upstream Publisherë¥¼ ê³µìœ  .share() // ë°˜í™˜ë˜ëŠ” íƒ€ì…ì„ ë§ì¶”ê¸° ìœ„í•¨ .eraseAnyPublisher() /** `.OBJC_ASSOCIATION_RETAIN` policyë¥¼ ì§€ì •í•˜ë©´ UIScrollViewê°€ DelegatePublisherì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ê°–ê²Œ ë˜ëŠ”ë°, `.OBJC_ASSOCIATION_ASSIGN` policyë¥¼ ì‚¬ìš©í•´ ì•½í•œ ì°¸ì¡°ë¥¼ ê°–ê²Œ í•˜ë©´ ì¼ë¶€ ì¼€ì´ìŠ¤ì—ì„œ ì˜ëª»ëœ ë©”ëª¨ë¦¬ ì°¸ì¡°ê°€ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì— `.OBJC_ASSOCIATION_RETAIN`ë¥¼ ì‚¬ìš©í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤ */ objc_setAssociatedObject(self, rawPointer, publisher, .OBJC_ASSOCIATION_RETAIN) return newPublisher } } } ì´ë ‡ê²Œ í•˜ë©´ UIScrollView í•˜ë‚˜ë‹¹ ìœ ì¼í•œ delegatePublisherê°€ ìƒê²¨ë‚˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ë²ˆ êµ¬ë…í•´ë„ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤. ë¬¼ë¡  ê¼­ Associated Objectë¥¼ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ë‹¤. ì°¨ë¼ë¦¬ ì•½í•œ ì°¸ì¡°ë¥¼ ê°–ëŠ” Dictionary íƒ€ì…ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ê¸€ë¡œë²Œ ìŠ¤í† ì–´ë¡œ ì“°ëŠ”ê²Œ í†µì œí•˜ê¸°ëŠ” ë” ì¢‹ì„ì§€ë„ ëª¨ë¥´ê² ë‹¤. ê·¼ë° ì—­ì‹œ ê·¸ê±´ ì¢€ ê·€ì°®ì•„ì„œâ€¦ğŸ˜…\në‹¤ë§Œ ì—¬ì „íˆ ì•„ì‰¬ì›€ì€ ë‚¨ëŠ”ë‹¤. Publisherê°€ ì•„ë‹Œ í˜•íƒœì˜ UIScrollViewDelegateì™€ DelegatePublisherë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ìˆ˜ë„ ìˆì§€ ì•Šì€ê°€. ì´ ë¬¸ì œë„ ë¹„êµì  ê°„ë‹¨í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ ì½”ë“œì™€ ê°™ì´ DelegateSubscriptionì— UIScrollViewì— ì´ë¯¸ í• ë‹¹ëœ delegateë¥¼ ì „ë‹¬í•˜ì—¬ ì•½í•œ ì°¸ì¡°ë¡œ ë“¤ê³  ìˆë„ë¡ í•˜ê³ , ëª¨ë“  UIScrollViewDelegate ë©”ì„œë“œë¥¼ êµ¬í˜„í† ë¡ í•´ì„œ ì´ë¥¼ formerDelegateì— ì „ë‹¬í•´ì£¼ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. ë¬¼ë¡  delegatePublisherë¥¼ ë¨¼ì € êµ¬ë…í•œ í›„ delegateë¥¼ ìƒˆë¡œ í• ë‹¹í•˜ë©´ ê¸°ëŒ€í•œ ëŒ€ë¡œ ì›€ì§ì´ì§€ ì•Šê² ì§€ë§Œâ€¦(ì´ì¯¤ë˜ë©´ ê± UIScrollView ìì²´ë¥¼ subclassing í•˜ëŠ”ê²Œ ë‚˜ì„ë“¯)\nclass DelegateSubscription: NSObject, UIScrollViewDelegate, Subscription where S.Input == DelegateEvent, S.Failure == Never { private weak var originalDelegate: UIScrollViewDelegate? private var subscriber: S? init(with subscriber: S, originalDelegate: UIScrollViewDelegate?) { self.subscriber = subscriber self.originalDelegate = originalDelegate } ... func scrollViewDidScroll(_ scrollView: UIScrollView) { originalDelegate?.scrollViewDidScroll?(scrollView) _ = subscriber?.receive(.didScroll(scrollView)) } // ì´í•˜ ë‚˜ë¨¸ì§€ UIScrollViewDelegate ë©”ì„œë“œ êµ¬í˜„(`originalDelegate`ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•¨) } ì´ê±¸ë¡œ ë‚˜ë¦„ ê°„ë‹¨í•˜ê²Œ Combineì„ ì´ìš©í•´ Delegate íŒ¨í„´ì— ëŒ€ì‘í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´¤ë‹¤. ì „ì²´ ì½”ë“œëŠ” ë”°ë¡œ Github ì €ì¥ì†Œì— ë§Œë“¤ì–´ë‘ì—ˆìœ¼ë‹ˆ í•œë²ˆ ì°¸ê³ í•´ë³´ëŠ” ê²ƒë„ ì¢‹ê² ë‹¤.\nì°¸ê³  SwiftBySundell - Building custom Combine publishers in Swift RxCocoa/DelegateProxyType.swift ì• í”Œ ê³µì‹ ë¬¸ì„œë“¤ Combine.Publisher Combine.Subscription Combine.Publishers.Share objc_getAssociatedObject(_:_:) objc_setAssociatedObject(_:_:_:_:) ObjectIdentifier ","wordCount":"3177","inLanguage":"en","datePublished":"2022-11-20T16:48:29+09:00","dateModified":"2022-11-20T16:48:29+09:00","author":{"@type":"Person","name":"êµ¬êµ¬ë¦¬"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bonoogi.github.io/posts/2022/11/delegate-publisher/"},"publisher":{"@type":"Organization","name":"Hell yeah, World","logo":{"@type":"ImageObject","url":"https://bonoogi.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bonoogi.github.io/ accesskey=h title="Hell yeah, World (Alt + H)">Hell yeah, World</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>UIKitì˜ Delegate íŒ¨í„´ì— Combineìœ¼ë¡œ ëŒ€ì‘í•˜ê¸°</h1><div class=post-description>ê·¼ë° ì†”ì§íˆ í´ë˜ìŠ¤ ë‚´ì—ì„œ ê± Delegate êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œ?</div><div class=post-meta><span title='2022-11-20 16:48:29 +0900 +0900'>November 20, 2022</span>&nbsp;Â·&nbsp;êµ¬êµ¬ë¦¬</div></header><div class=post-content><p>Reactive Programmingì˜ ëŒ€ëª…ì‚¬ ê·¸ ìì²´ì¸ Reactive Extension(ì´í•˜ Rx), ê·¸ë¦¬ê³  ê·¸ ì¤‘ì—ì„œë„ Apple ìƒíƒœê³„ ê°œë°œìë¥¼ ìœ„í•œ Rx êµ¬í˜„ì¸ <a href=https://github.com/ReactiveX/RxSwift>RxSwift</a>, ê·¸ ì¤‘ì—ì„œë„ UIKitì„ ìœ„í•œ êµ¬í˜„ì¸ RxCocoaë¥¼ ë³´ë©´ ê°ì¢… UIKitì˜ Delegate íŒ¨í„´ì— ëŒ€ì‘í•˜ëŠ” Observableì„ ì œê³µí•˜ê³  ìˆë‹¤. Rxë¥¼ ì²˜ìŒ ì ‘í•œ ê·¸ ë‹¹ì‹œì—ëŠ” &lsquo;ì™€ ì”» ì™„ì „ ì‹ ì„¸ê³„ë‹¤!&rsquo; ì‹¶ì–´ ê±°ì˜ ëª¨ë“  ì½”ë“œë¥¼ Rx ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í–ˆì—ˆëŠ”ë°, ê·¸ë˜ì„œ Delegate íŒ¨í„´ì— ëŒ€í•œ êµ¬í˜„ë„ Rxë¥¼ ë§ì´ ì¼ë˜ ê¸°ì–µì´ ë‚œë‹¤. ì§€ê¸ˆì€ ê± Delegateë¥¼ ì§ì ‘ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ì¢€ ë” ì„ í˜¸í•˜ëŠ” í¸ì´ì§€ë§Œ&mldr;</p><p>ì–´ì¨Œë“ , ìµœê·¼ì— ì§„í–‰í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ RxSwift ì˜ì¡´ì„±ì„ Combineìœ¼ë¡œ ì´ì „í•˜ëŠ” ì‘ì—…ì„ í–ˆë‹¤. ì´ ë•Œ <code>UIScrollViewDelegate</code>ì˜ <code>scrollViewDidScroll(_ scrollView: UIScrollView)</code> ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œì˜ ë™ì‘ì„ Combineìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì‘ì—…ë„ ê°™ì´ ì§„í–‰í–ˆëŠ”ë°, ì´ ì²˜ë¦¬ì— ëŒ€í•´ì„œ ì¢€ ì•Œì•„ë³´ë„ë¡ í•˜ì.</p><p>ì¼ë‹¨ ì„¸ ê°€ì§€ì˜ íƒ€ì…ì´ í•„ìš”í•˜ë‹¤. <code>Publisher</code> í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ëŠ” íƒ€ì…ê³¼ <code>Subscription</code> í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ëŠ” íƒ€ì…(ê° í”„ë¡œí† ì½œì´ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ëŠ” ë¬¸ì„œë¥¼ í†µí•´ ì•Œì•„ë³´ë„ë¡ í•˜ì). ê·¸ë¦¬ê³  <code>UIScrollViewDelegate</code>ì˜ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œê°€ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ê¸° ìœ„í•œ ì—´ê±°í˜• íƒ€ì….</p><p>ê·¸ë¦¬ê³  <code>UIScrollViewDelegate</code>ì— ëŒ€í•œ êµ¬í˜„ì´ê¸° ë•Œë¬¸ì— <code>UIScrollView</code>ì— ëŒ€í•œ í™•ì¥ìœ¼ë¡œ ì„ ì–¸í•˜ëŠ”ê²Œ ì¨ë¨¹ê¸° í¸í• ê±°ë¼ ìƒê°í–ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ê²°êµ­ ë‹¤ìŒì˜ ì„¸ íƒ€ì…ì„ ë§Œë“¤ê²Œ ë  ê²ƒì´ë‹¤.</p><ul><li><code>UIScrollView.DelegateEvent</code>(ì´í•˜ <code>DelegateEvent</code>): <code>UIScrollViewDelegate</code>ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ í˜¸ì¶œë  ë©”ì„œë“œì™€ ì¸ìë¥¼ ì „ë‹¬í•´ì¤„ íƒ€ì…. ê°„ë‹¨í•˜ê²Œ <code>enum</code>ìœ¼ë¡œ êµ¬í˜„í•  ì˜ˆì •ì´ë‹¤.</li><li><code>UIScrollView.DelegateSubscription</code>(ì´í•˜ <code>DelegateSubscription</code>): êµ¬ë…ì‹œ êµ¬ë…ìì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ì¤„ íƒ€ì…ìœ¼ë¡œ(ìì„¸í•œ ê²ƒì„ ì• í”Œì˜ <a href=https://developer.apple.com/documentation/combine/subscription><code>Combine.Subscription</code> ë¬¸ì„œ</a>ë¥¼ í™•ì¸), ì‹¤ì œë¡œ <code>UIScrollViewDelegate</code>ë¥¼ êµ¬í˜„í•˜ëŠ” íƒ€ì…ì´ ë ê²ƒì´ë‹¤.</li><li><code>UIScrollView.DelegatePublisher</code>(ì´í•˜ <code>DelegatePublisher</code>): ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ì¤„ ê²Œì‹œì íƒ€ì…. ì´ ì—­ì‹œ ì• í”Œì˜ <a href=https://developer.apple.com/documentation/combine/publisher><code>Combine.Publisher</code> ë¬¸ì„œ</a>ë¥¼ í™•ì¸í•˜ì.</li></ul><p>ìœ„ ì„¸ê°€ì§€ íƒ€ì…ì„ ê¸°ëŠ¥ë§Œ í•˜ë„ë¡ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì´ë‹¤. ê¸°ë³¸ êµ¬í˜„ ìì²´ì— ëŒ€í•´ì„œëŠ” ë”°ë¡œ ì„¤ëª…í•˜ì§„ ì•Šê² ë‹¤. <code>Subscription</code>ê³¼ <code>Publisher</code> êµ¬í˜„ì˜ ê²½ìš° SwiftBySundellì˜ <a href=https://www.swiftbysundell.com/articles/building-custom-combine-publishers-in-swift/>Building custom Combine publishers in Swift</a>ì„ ì°¸ê³ í•˜ì˜€ìœ¼ë‹ˆ í•´ë‹¹ ì•„í‹°í´ì„ ì²´í¬í•˜ê¸¸ ë°”ë€ë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>DelegateEvent</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// `scrollViewDidScroll(_ scrollView: UIScrollView)` ì— ëŒ€ì‘í•˜ëŠ” ì¼€ì´ìŠ¤</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> didScroll(UIScrollView)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DelegateSubscription</span>&lt;S: Subscriber&gt;: NSObject, UIScrollViewDelegate, 
</span></span><span style=display:flex><span>    Subscription <span style=color:#66d9ef>where</span> S.Input == DelegateEvent, S.Failure == Never {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> subscriber: S?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(subscriber: S) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.subscriber = subscriber
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>request</span>(<span style=color:#66d9ef>_</span> demand: Subscribers.Demand) { <span style=color:#75715e>/* Do Nothing */</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>cancel</span>() {
</span></span><span style=display:flex><span>        subscriber = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// UIScrollViewDelegate êµ¬í˜„</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>scrollViewDidScroll</span>(<span style=color:#66d9ef>_</span> scrollView: UIScrollView) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>_</span> = subscriber?.receive(.didScroll(scrollView))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>DelegatePublisher</span>: Publisher {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typealias</span> Output = DelegateEvent
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typealias</span> Failure = Never
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>let</span> scrollView: UIScrollView
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(scrollView: UIScrollView) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.scrollView = scrollView
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>receive</span>&lt;S&gt;(subscriber: S) <span style=color:#66d9ef>where</span> S: Subscriber, Never == S.Failure, DelegateEvent == S.Input {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> subscription = DelegateSubscription(subscriber: subscriber)
</span></span><span style=display:flex><span>        subscriber.receive(subscription: subscription)
</span></span><span style=display:flex><span>        scrollView.delegate = subscription
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ìœ„ì™€ ê°™ì´ êµ¬í˜„í•˜ê³  <code>UIScrollView</code>ì˜ í™•ì¥ì— ê³„ì‚° í”„ë¡œí¼í‹°ë¡œ <code>delegatePublisher</code>ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>UIScrollView</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> delegatePublisher: DelegatePublisher {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DelegatePublisher(scrollView: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> scrollView = UIScrollView() 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> cancellable = scrollView
</span></span><span style=display:flex><span>    .delegatePublisher
</span></span><span style=display:flex><span>    .sink { event <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> event {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .didScroll(<span style=color:#66d9ef>let</span> scrollView):
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Do Something With `scrollView`</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>ì œë²• ê°„ë‹¨í•˜ë‹¤. í•˜ì§€ë§Œ ì´ ë•Œ ë¬¸ì œê°€ í•˜ë‚˜ ìˆë‹¤. <code>UIScrollView.delegate</code>ëŠ” <code>UIView</code>ì— <code>UIGestureRecognizer</code>ë¥¼ ë“±ë¡í•˜ë“¯ì´ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ”ê²Œ ì•„ë‹ˆê³ , í•œ ë²ˆì— í•˜ë‚˜ì˜ <code>delegate</code>ë§Œ í• ë‹¹í•  ìˆ˜ ìˆê¸° ë•Œë¬¸. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ ì½”ë“œì—ì„œëŠ” ë‘ ë²ˆì§¸ <code>delegatePublsher</code>ë¥¼ í˜¸ì¶œí•  ë•Œ ì²«ë²ˆì§¸ë¡œ í˜¸ì¶œí•œ <code>delegatePublisher</code>ëŠ” <code>scrollView</code>ì˜ <code>delegate</code>ê°€ ì•„ë‹ˆê²Œ ëœë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>var</span> first = scrollView.delegatePublisher.sink { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span> print(<span style=color:#e6db74>&#34;Useless!&#34;</span>) }
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> second = scrollView.delegatePublisher.sink { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span> print(<span style=color:#e6db74>&#34;Only Works!&#34;</span>) }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ì•„ë˜ì™€ ê°™ì´ í•´ê²°í•  ìˆ˜ëŠ” ìˆì§€ë§Œ ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ `share()`ë¡œ</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ë³„ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹¤ìˆ˜í•˜ê¸°ì— ë„ˆë¬´ ì¢‹ì€ ì½”ë“œì´ë‹¤.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> sharedDelegatePublisher = scrollView.delegatePublisher.share()
</span></span><span style=display:flex><span>first = sharedDelegatePublisher.sink { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span> print(<span style=color:#e6db74>&#34;It Works!&#34;</span>) }
</span></span><span style=display:flex><span>second = sharedDelegatePublisher.sink { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span> print(<span style=color:#e6db74>&#34;It Works, Too!&#34;</span>) }
</span></span></code></pre></div><p>ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ <code>delegatePublisher</code>ë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•´ë„ ê³„ì† ì¨ë¨¹ì„ ìˆ˜ ìˆì„ê¹Œ? ì´ë¥¼ ìœ„í•´ì„œëŠ” ë‘ ê°€ì§€ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤.</p><ul><li><code>UIScrollView.delegatePublisher</code>ê°€ <code>UIScrollView</code> ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ë‹¹ í•˜ë‚˜ë§Œ ìƒì„±ë˜ì–´ì•¼ í•œë‹¤. ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±í•˜ë©´ ì´ì „ì— ìƒì„±í•œ <code>Publisher</code>ì— ëŒ€í•œ <code>Subscription</code>ì€ ì˜ë¯¸ê°€ ì—†ì–´ì§€ë‹ˆê¹Œ.</li><li>ìœ„ì—ì„œ ìƒê¸´ í•˜ë‚˜ì˜ <code>DelegatePublisher</code>ë¥¼ ì—¬ëŸ¬ <code>Subscriber</code>ê°€ ê³µìœ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. <code>Subscriber</code>ê°€ ìƒê¸¸ë•Œë§ˆë‹¤ delegateë¥¼ í• ë‹¹í•˜ë©´ ê²°êµ­ ì—¬ì „íˆ ìµœí›„ì˜ <code>Subscriber</code>ë§Œ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ.</li></ul><p>ì²«ë²ˆì§¸ ì¡°ê±´ì€ ë°”ê¿” ë§í•˜ìë©´ <code>UIScrollView</code> ì¸ìŠ¤í„´ìŠ¤ê°€ íŠ¹ì •ë˜ë©´ ê±°ê¸°ì— ì—°ê²°ëœ <code>DelegatePublisher</code>ë„ íŠ¹ì •í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ëŠ” ì–˜ê¸°ë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” RxSwiftê°€ í•´ê²°í•œ ë°©ë²•ì„ ì°¸ê³ í–ˆë‹¤. ì´ ì¹œêµ¬ë“¤ì€ <a href=https://github.com/ReactiveX/RxSwift/blob/main/RxCocoa/Common/DelegateProxyType.swift>RxCocoa ë‚´ì— <code>DelegateProxyType</code>ì´ë¼ëŠ” íƒ€ì…</a>ì„ ë§Œë“¤ì–´ì„œ ë³„ë„ì˜ ëŒ€ë¦¬ìë¥¼ ë§Œë“¤ì—ˆê³ , ì´ ì¹œêµ¬ë¥¼ <code>UIScrollView</code> ì¸ìŠ¤í„´ìŠ¤ì—ë‹¤ê°€ Associated Objectë¡œ í• ë‹¹ì„ í•˜ëŠ” ì‹ìœ¼ë¡œ í•´ê²°í•˜ì˜€ë‹¤. ë¬¼ë¡  <code>DelegateProxyType</code>ì´ Delegate ì—­í• ì„ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê³ , ì¼ì¢…ì˜ ì—°ê²°ì ì´ë¼ê³  ë³´ëŠ”ê²Œ ë‚«ê² ì§€ë§Œ&mldr;(proxyë¼ëŠ” ë§ì„ ê´œíˆ ì“´ê²Œ ì•„ë‹˜)</p><p>ë‘ë²ˆì§¸ ì¡°ê±´ì€ ì˜ ìƒê°í•´ë³´ë©´ ì–´ë””ì„œ ë³¸ ë§ì´ë‹¤. ë°”ë¡œ <a href=https://developer.apple.com/documentation/combine/publishers/share><code>Publishers.Share</code></a>ë‹¤. ì• í”Œ ë¬¸ì„œìƒì—ì„œ ì´ ì¹œêµ¬ì˜ ì •ì˜ë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì™€ìˆë‹¤.</p><blockquote><p>A publisher that shares the output of an upstream publisher with multiple subscribers.</p></blockquote><p>Upstream Publisherì˜ ë°°ì¶œì„ ì—¬ëŸ¬ Subscriberì™€ ê³µìœ í•˜ëŠ” Publisher. ê²°êµ­ ë‘ë²ˆì§¸ ì¡°ê±´ì€ <code>Share</code>ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°ëœë‹¤. ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë§Œë“¤ì–´ì§„ë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>UIScrollView</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> delegatePublisher: AnyPublisher&lt;DelegateEvent, Never&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>        `ObjectIdentifier`ëŠ” `AnyObject` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°›ê±°ë‚˜ `Any.Type` í˜•íƒœì˜
</span></span></span><span style=display:flex><span><span style=color:#75715e>        ë©”íƒ€íƒ€ì…ì„ ë°›ì•„ì„œ IDë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš°ì—ëŠ” `UIScrollView` ì¸ìŠ¤í„´ìŠ¤ì—
</span></span></span><span style=display:flex><span><span style=color:#75715e>        ìœ ì¼í•œ `DelegatePublisher`ë¥¼ í• ë‹¹í•˜ëŠ”ê²Œ ëª©í‘œì´ë‹ˆ ë©”íƒ€íƒ€ì…ì„ í†µí•´ IDë¥¼ ìƒì„±í•œë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e>        
</span></span></span><span style=display:flex><span><span style=color:#75715e>        ì‚¬ì‹¤ ì´ë ‡ê²Œ ì•ˆí•˜ê³  ì•„ë˜ì²˜ëŸ¼ íŠ¹ì • ë¬¸ìì—´ì„ ë§Œë“¤ì–´ì„œ ê·¸ì— ëŒ€í•œ UnsafeRawPointerë¥¼ ë§Œë“¤ì–´ë„ ë¬´ë°©í•  ê²ƒ ê°™ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e>        let someStr = &#34;SomeStr&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>        let rawPointer = &amp;someStr
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> objectIdentifier = ObjectIdentifier(DelegatePublisher.<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> integerIdentifier = Int(bitPattern: objectIdentifier)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> rawPointer = UnsafeRawPointer(bitPatter: integerIdentifier)<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> existingPublisher = objc_getAssociatedObject(<span style=color:#66d9ef>self</span>, rawPointer) <span style=color:#66d9ef>as</span>? AnyPublisher&lt;DelegateEvent, Never&gt; {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> existingPublisher
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> newPublisher = DelegatePublisher(scrollView: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// ì—¬ëŸ¬ Subscriberê°€ í•˜ë‚˜ì˜ Upstream Publisherë¥¼ ê³µìœ </span>
</span></span><span style=display:flex><span>                .share()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// ë°˜í™˜ë˜ëŠ” íƒ€ì…ì„ ë§ì¶”ê¸° ìœ„í•¨</span>
</span></span><span style=display:flex><span>                .eraseAnyPublisher()
</span></span><span style=display:flex><span>            <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>            `.OBJC_ASSOCIATION_RETAIN` policyë¥¼ ì§€ì •í•˜ë©´ UIScrollViewê°€
</span></span></span><span style=display:flex><span><span style=color:#75715e>            DelegatePublisherì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ê°–ê²Œ ë˜ëŠ”ë°, `.OBJC_ASSOCIATION_ASSIGN`
</span></span></span><span style=display:flex><span><span style=color:#75715e>            policyë¥¼ ì‚¬ìš©í•´ ì•½í•œ ì°¸ì¡°ë¥¼ ê°–ê²Œ í•˜ë©´ ì¼ë¶€ ì¼€ì´ìŠ¤ì—ì„œ ì˜ëª»ëœ ë©”ëª¨ë¦¬ ì°¸ì¡°ê°€ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì—
</span></span></span><span style=display:flex><span><span style=color:#75715e>            `.OBJC_ASSOCIATION_RETAIN`ë¥¼ ì‚¬ìš©í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤
</span></span></span><span style=display:flex><span><span style=color:#75715e>             */</span>
</span></span><span style=display:flex><span>            objc_setAssociatedObject(<span style=color:#66d9ef>self</span>, rawPointer, publisher, .OBJC_ASSOCIATION_RETAIN)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> newPublisher
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ì´ë ‡ê²Œ í•˜ë©´ <code>UIScrollView</code> í•˜ë‚˜ë‹¹ ìœ ì¼í•œ <code>delegatePublisher</code>ê°€ ìƒê²¨ë‚˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ë²ˆ êµ¬ë…í•´ë„ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤. ë¬¼ë¡  ê¼­ Associated Objectë¥¼ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ë‹¤. ì°¨ë¼ë¦¬ ì•½í•œ ì°¸ì¡°ë¥¼ ê°–ëŠ” <code>Dictionary</code> íƒ€ì…ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ê¸€ë¡œë²Œ ìŠ¤í† ì–´ë¡œ ì“°ëŠ”ê²Œ í†µì œí•˜ê¸°ëŠ” ë” ì¢‹ì„ì§€ë„ ëª¨ë¥´ê² ë‹¤. ê·¼ë° ì—­ì‹œ ê·¸ê±´ ì¢€ ê·€ì°®ì•„ì„œ&mldr;ğŸ˜…</p><p>ë‹¤ë§Œ ì—¬ì „íˆ ì•„ì‰¬ì›€ì€ ë‚¨ëŠ”ë‹¤. <code>Publisher</code>ê°€ ì•„ë‹Œ í˜•íƒœì˜ <code>UIScrollViewDelegate</code>ì™€ <code>DelegatePublisher</code>ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ìˆ˜ë„ ìˆì§€ ì•Šì€ê°€. ì´ ë¬¸ì œë„ ë¹„êµì  ê°„ë‹¨í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ ì½”ë“œì™€ ê°™ì´ <code>DelegateSubscription</code>ì— <code>UIScrollView</code>ì— ì´ë¯¸ í• ë‹¹ëœ <code>delegate</code>ë¥¼ ì „ë‹¬í•˜ì—¬ ì•½í•œ ì°¸ì¡°ë¡œ ë“¤ê³  ìˆë„ë¡ í•˜ê³ , ëª¨ë“  <code>UIScrollViewDelegate</code> ë©”ì„œë“œë¥¼ êµ¬í˜„í† ë¡ í•´ì„œ ì´ë¥¼ <code>formerDelegate</code>ì— ì „ë‹¬í•´ì£¼ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. ë¬¼ë¡  <code>delegatePublisher</code>ë¥¼ ë¨¼ì € êµ¬ë…í•œ í›„ <code>delegate</code>ë¥¼ ìƒˆë¡œ í• ë‹¹í•˜ë©´ ê¸°ëŒ€í•œ ëŒ€ë¡œ ì›€ì§ì´ì§€ ì•Šê² ì§€ë§Œ&mldr;(ì´ì¯¤ë˜ë©´ ê± <code>UIScrollView</code> ìì²´ë¥¼ subclassing í•˜ëŠ”ê²Œ ë‚˜ì„ë“¯)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DelegateSubscription</span>&lt;S: Subscriber&gt;: NSObject, UIScrollViewDelegate, Subscription <span style=color:#66d9ef>where</span> S.Input == DelegateEvent, S.Failure == Never {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>weak</span> <span style=color:#66d9ef>var</span> originalDelegate: UIScrollViewDelegate?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> subscriber: S?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(with subscriber: S, originalDelegate: UIScrollViewDelegate?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.subscriber = subscriber
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.originalDelegate = originalDelegate
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>scrollViewDidScroll</span>(<span style=color:#66d9ef>_</span> scrollView: UIScrollView) {
</span></span><span style=display:flex><span>        originalDelegate?.scrollViewDidScroll?(scrollView)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>_</span> = subscriber?.receive(.didScroll(scrollView))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ì´í•˜ ë‚˜ë¨¸ì§€ UIScrollViewDelegate ë©”ì„œë“œ êµ¬í˜„(`originalDelegate`ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•¨)</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ì´ê±¸ë¡œ ë‚˜ë¦„ ê°„ë‹¨í•˜ê²Œ Combineì„ ì´ìš©í•´ Delegate íŒ¨í„´ì— ëŒ€ì‘í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´¤ë‹¤. ì „ì²´ ì½”ë“œëŠ” <a href=https://github.com/bonoogi/DelegatePublisher>ë”°ë¡œ Github ì €ì¥ì†Œ</a>ì— ë§Œë“¤ì–´ë‘ì—ˆìœ¼ë‹ˆ í•œë²ˆ ì°¸ê³ í•´ë³´ëŠ” ê²ƒë„ ì¢‹ê² ë‹¤.</p><h3 id=ì°¸ê³ >ì°¸ê³ <a hidden class=anchor aria-hidden=true href=#ì°¸ê³ >#</a></h3><ul><li><a href=https://www.swiftbysundell.com/articles/building-custom-combine-publishers-in-swift/>SwiftBySundell - Building custom Combine publishers in Swift</a></li><li><a href=https://github.com/ReactiveX/RxSwift/blob/main/RxCocoa/Common/DelegateProxyType.swift>RxCocoa/DelegateProxyType.swift</a></li><li>ì• í”Œ ê³µì‹ ë¬¸ì„œë“¤<ul><li><a href=https://developer.apple.com/documentation/combine/publisher><code>Combine.Publisher</code></a></li><li><a href=https://developer.apple.com/documentation/combine/subscription><code>Combine.Subscription</code></a></li><li><a href=https://developer.apple.com/documentation/combine/publishers/share><code>Combine.Publishers.Share</code></a></li><li><a href=https://developer.apple.com/documentation/objectivec/1418865-objc_getassociatedobject><code>objc_getAssociatedObject(_:_:)</code></a></li><li><a href=https://developer.apple.com/documentation/objectivec/1418509-objc_setassociatedobject><code>objc_setAssociatedObject(_:_:_:_:)</code></a></li><li><a href=https://developer.apple.com/documentation/swift/objectidentifier><code>ObjectIdentifier</code></a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bonoogi.github.io/tags/ios/>iOS</a></li><li><a href=https://bonoogi.github.io/tags/swift/>swift</a></li><li><a href=https://bonoogi.github.io/tags/uikit/>UIKit</a></li><li><a href=https://bonoogi.github.io/tags/combine/>combine</a></li><li><a href=https://bonoogi.github.io/tags/delegate/>Delegate</a></li><li><a href=https://bonoogi.github.io/tags/rxswift/>RxSwift</a></li><li><a href=https://bonoogi.github.io/tags/rxcocoa/>RxCocoa</a></li></ul></footer><script src=https://utteranc.es/client.js repo=bonoogi/blog-comment issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://bonoogi.github.io/>Hell yeah, World</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>